{"ast":null,"code":"\"use strict\";\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n    label: 0,\n    sent: function () {\n      if (t[0] & 1) throw t[1];\n      return t[1];\n    },\n    trys: [],\n    ops: []\n  },\n      f,\n      y,\n      t,\n      g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n\n    while (_) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n\n        case 7:\n          op = _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n\n            _.ops.push(op);\n\n            break;\n          }\n\n          if (t[2]) _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n      }\n\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.GraphQLWebSocketClient = void 0;\n\nvar types_1 = require(\"./types\");\n\nvar _1 = require(\".\");\n\nvar CONNECTION_INIT = 'connection_init';\nvar CONNECTION_ACK = 'connection_ack';\nvar PING = 'ping';\nvar PONG = 'pong';\nvar SUBSCRIBE = 'subscribe';\nvar NEXT = 'next';\nvar ERROR = 'error';\nvar COMPLETE = 'complete';\n\nvar GraphQLWebSocketMessage =\n/** @class */\nfunction () {\n  function GraphQLWebSocketMessage(type, payload, id) {\n    this._type = type;\n    this._payload = payload;\n    this._id = id;\n  }\n\n  Object.defineProperty(GraphQLWebSocketMessage.prototype, \"type\", {\n    get: function () {\n      return this._type;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(GraphQLWebSocketMessage.prototype, \"id\", {\n    get: function () {\n      return this._id;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(GraphQLWebSocketMessage.prototype, \"payload\", {\n    get: function () {\n      return this._payload;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(GraphQLWebSocketMessage.prototype, \"text\", {\n    get: function () {\n      var result = {\n        type: this.type\n      };\n      if (this.id != null && this.id != undefined) result.id = this.id;\n      if (this.payload != null && this.payload != undefined) result.payload = this.payload;\n      return JSON.stringify(result);\n    },\n    enumerable: false,\n    configurable: true\n  });\n\n  GraphQLWebSocketMessage.parse = function (data, f) {\n    var _a = JSON.parse(data),\n        type = _a.type,\n        payload = _a.payload,\n        id = _a.id;\n\n    return new GraphQLWebSocketMessage(type, f(payload), id);\n  };\n\n  return GraphQLWebSocketMessage;\n}();\n\nvar GraphQLWebSocketClient =\n/** @class */\nfunction () {\n  function GraphQLWebSocketClient(socket, _a) {\n    var _this = this;\n\n    var onInit = _a.onInit,\n        onAcknowledged = _a.onAcknowledged,\n        onPing = _a.onPing,\n        onPong = _a.onPong;\n    this.socketState = {\n      acknowledged: false,\n      lastRequestId: 0,\n      subscriptions: {}\n    };\n    this.socket = socket;\n\n    socket.onopen = function (e) {\n      return __awaiter(_this, void 0, void 0, function () {\n        var _a, _b, _c, _d;\n\n        return __generator(this, function (_e) {\n          switch (_e.label) {\n            case 0:\n              this.socketState.acknowledged = false;\n              this.socketState.subscriptions = {};\n              _b = (_a = socket).send;\n              _c = ConnectionInit;\n              if (!onInit) return [3\n              /*break*/\n              , 2];\n              return [4\n              /*yield*/\n              , onInit()];\n\n            case 1:\n              _d = _e.sent();\n              return [3\n              /*break*/\n              , 3];\n\n            case 2:\n              _d = null;\n              _e.label = 3;\n\n            case 3:\n              _b.apply(_a, [_c.apply(void 0, [_d]).text]);\n\n              return [2\n              /*return*/\n              ];\n          }\n        });\n      });\n    };\n\n    socket.onclose = function (e) {\n      _this.socketState.acknowledged = false;\n      _this.socketState.subscriptions = {};\n    };\n\n    socket.onerror = function (e) {\n      console.error(e);\n    };\n\n    socket.onmessage = function (e) {\n      try {\n        var message = parseMessage(e.data);\n\n        switch (message.type) {\n          case CONNECTION_ACK:\n            {\n              if (_this.socketState.acknowledged) {\n                console.warn(\"Duplicate CONNECTION_ACK message ignored\");\n              } else {\n                _this.socketState.acknowledged = true;\n                if (onAcknowledged) onAcknowledged(message.payload);\n              }\n\n              return;\n            }\n\n          case PING:\n            {\n              if (onPing) onPing(message.payload).then(function (r) {\n                return socket.send(Pong(r).text);\n              });else socket.send(Pong(null).text);\n              return;\n            }\n\n          case PONG:\n            {\n              if (onPong) onPong(message.payload);\n              return;\n            }\n        }\n\n        if (!_this.socketState.acknowledged) {\n          // Web-socket connection not acknowledged\n          return;\n        }\n\n        if (message.id === undefined || message.id === null || !_this.socketState.subscriptions[message.id]) {\n          // No subscription identifer or subscription indentifier is not found\n          return;\n        }\n\n        var _a = _this.socketState.subscriptions[message.id],\n            query = _a.query,\n            variables = _a.variables,\n            subscriber = _a.subscriber;\n\n        switch (message.type) {\n          case NEXT:\n            {\n              if (!message.payload.errors && message.payload.data) {\n                subscriber.next && subscriber.next(message.payload.data);\n              }\n\n              if (message.payload.errors) {\n                subscriber.error && subscriber.error(new types_1.ClientError(__assign(__assign({}, message.payload), {\n                  status: 200\n                }), {\n                  query: query,\n                  variables: variables\n                }));\n              } else {}\n\n              return;\n            }\n\n          case ERROR:\n            {\n              subscriber.error && subscriber.error(new types_1.ClientError({\n                errors: message.payload,\n                status: 200\n              }, {\n                query: query,\n                variables: variables\n              }));\n              return;\n            }\n\n          case COMPLETE:\n            {\n              subscriber.complete && subscriber.complete();\n              delete _this.socketState.subscriptions[message.id];\n              return;\n            }\n        }\n      } catch (e) {\n        // Unexpected errors while handling graphql-ws message\n        console.error(e);\n        socket.close(1006);\n      }\n\n      socket.close(4400, \"Unknown graphql-ws message.\");\n    };\n  }\n\n  GraphQLWebSocketClient.prototype.makeSubscribe = function (query, operationName, variables, subscriber) {\n    var _this = this;\n\n    var subscriptionId = (this.socketState.lastRequestId++).toString();\n    this.socketState.subscriptions[subscriptionId] = {\n      query: query,\n      variables: variables,\n      subscriber: subscriber\n    };\n    this.socket.send(Subscribe(subscriptionId, {\n      query: query,\n      operationName: operationName,\n      variables: variables\n    }).text);\n    return function () {\n      _this.socket.send(Complete(subscriptionId).text);\n\n      delete _this.socketState.subscriptions[subscriptionId];\n    };\n  };\n\n  GraphQLWebSocketClient.prototype.rawRequest = function (query, variables) {\n    var _this = this;\n\n    return new Promise(function (resolve, reject) {\n      var result;\n\n      _this.rawSubscribe(query, {\n        next: function (data, extensions) {\n          return result = {\n            data: data,\n            extensions: extensions\n          };\n        },\n        error: reject,\n        complete: function () {\n          return resolve(result);\n        }\n      }, variables);\n    });\n  };\n\n  GraphQLWebSocketClient.prototype.request = function (document, variables) {\n    var _this = this;\n\n    return new Promise(function (resolve, reject) {\n      var result;\n\n      _this.subscribe(document, {\n        next: function (data) {\n          return result = data;\n        },\n        error: reject,\n        complete: function () {\n          return resolve(result);\n        }\n      }, variables);\n    });\n  };\n\n  GraphQLWebSocketClient.prototype.subscribe = function (document, subscriber, variables) {\n    var _a = _1.resolveRequestDocument(document),\n        query = _a.query,\n        operationName = _a.operationName;\n\n    return this.makeSubscribe(query, operationName, variables, subscriber);\n  };\n\n  GraphQLWebSocketClient.prototype.rawSubscribe = function (query, subscriber, variables) {\n    return this.makeSubscribe(query, undefined, variables, subscriber);\n  };\n\n  GraphQLWebSocketClient.prototype.ping = function (payload) {\n    this.socket.send(Ping(payload).text);\n  };\n\n  GraphQLWebSocketClient.prototype.close = function () {\n    this.socket.close(1000);\n  };\n\n  GraphQLWebSocketClient.PROTOCOL = \"graphql-transport-ws\";\n  return GraphQLWebSocketClient;\n}();\n\nexports.GraphQLWebSocketClient = GraphQLWebSocketClient; // Helper functions\n\nfunction parseMessage(data, f) {\n  if (f === void 0) {\n    f = function (a) {\n      return a;\n    };\n  }\n\n  var m = GraphQLWebSocketMessage.parse(data, f);\n  return m;\n}\n\nfunction ConnectionInit(payload) {\n  return new GraphQLWebSocketMessage(CONNECTION_INIT, payload);\n}\n\nfunction Ping(payload) {\n  return new GraphQLWebSocketMessage(PING, payload, undefined);\n}\n\nfunction Pong(payload) {\n  return new GraphQLWebSocketMessage(PONG, payload, undefined);\n}\n\nfunction Subscribe(id, payload) {\n  return new GraphQLWebSocketMessage(SUBSCRIBE, payload, id);\n}\n\nfunction Complete(id) {\n  return new GraphQLWebSocketMessage(COMPLETE, undefined, id);\n}","map":{"version":3,"mappings":"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","names":["CONNECTION_INIT","CONNECTION_ACK","PING","PONG","SUBSCRIBE","NEXT","ERROR","COMPLETE","type","payload","id","_type","_payload","_id","Object","GraphQLWebSocketMessage","result","undefined","JSON","stringify","data","f","parse","socket","_a","onInit","onAcknowledged","onPing","onPong","acknowledged","lastRequestId","subscriptions","onopen","e","socketState","_b","send","_c","_d","text","onclose","_this","onerror","console","error","onmessage","message","parseMessage","warn","then","Pong","r","query","variables","subscriber","errors","next","types_1","__assign","status","complete","close","GraphQLWebSocketClient","operationName","subscriptionId","toString","Subscribe","Complete","Promise","resolve","reject","rawSubscribe","extensions","document","subscribe","_1","makeSubscribe","Ping","exports","a","m","ConnectionInit"],"sources":["/Users/natehanson/Desktop/reactiondata-frontend/node_modules/graphql-request/src/graphql-ws.ts"],"sourcesContent":["import { ClientError, RequestDocument, Variables } from './types';\nimport * as Dom from './types.dom'\nimport { resolveRequestDocument } from '.';\n\nconst CONNECTION_INIT = 'connection_init'\nconst CONNECTION_ACK = 'connection_ack'\nconst PING = 'ping'\nconst PONG = 'pong'\nconst SUBSCRIBE = 'subscribe'\nconst NEXT = 'next'\nconst ERROR = 'error'\nconst COMPLETE = 'complete'\n\ntype MessagePayload = { [key: string]: any }\n\ntype SubscribePayload<V = Variables, E = any> = {\n    operationName?: string | null;\n    query: string;\n    variables?: V;\n    extensions?: E;\n}\n\nclass GraphQLWebSocketMessage<A = MessagePayload> {\n\n    private _type: string\n    private _id?: string\n    private _payload?: A\n\n    public get type(): string { return this._type }\n    public get id(): string | undefined { return this._id }\n    public get payload(): A | undefined { return this._payload; }\n\n    constructor(type: string, payload?: A, id?: string) {\n        this._type = type\n        this._payload = payload\n        this._id = id\n    }\n\n    public get text(): string {\n        const result: any = { type: this.type }\n        if (this.id != null && this.id != undefined) result.id = this.id\n        if (this.payload != null && this.payload != undefined) result.payload = this.payload\n        return JSON.stringify(result)\n    }\n\n    static parse<A>(data: string, f: (payload: any) => A): GraphQLWebSocketMessage<A> {\n        const { type, payload, id }: { type: string, payload: any, id: string } = JSON.parse(data)\n        return new GraphQLWebSocketMessage(type, f(payload), id)\n    }\n}\n\nexport type SocketHandler = {\n    onInit?: <T>() => Promise<T>,\n    onAcknowledged?: <A>(payload?: A) => Promise<void>,\n    onPing?: <In, Out>(payload: In) => Promise<Out>\n    onPong?: <T>(payload: T) => any\n    onClose?: () => any\n}\n\nexport type UnsubscribeCallback = () => void;\n\nexport interface GraphQLSubscriber<T, E=unknown> {\n  next?(data: T, extensions?: E): void;\n  error?(errorValue: ClientError): void;\n  complete?(): void;\n}\n\ntype SubscriptionRecord = {\n    subscriber: GraphQLSubscriber<unknown, unknown>\n    query: string,\n    variables: Variables\n}\n\ntype SocketState = {\n    acknowledged: boolean\n    lastRequestId: number\n    subscriptions: { [key: string]: SubscriptionRecord }\n}\n\nexport class GraphQLWebSocketClient {\n\n    static PROTOCOL: string = \"graphql-transport-ws\"\n\n    private socket: WebSocket\n    private socketState: SocketState = { acknowledged: false, lastRequestId: 0, subscriptions: {} }\n\n    constructor(socket: WebSocket, { onInit, onAcknowledged, onPing, onPong }: SocketHandler) {\n        this.socket = socket\n\n        socket.onopen = async (e) => {\n            this.socketState.acknowledged = false;\n            this.socketState.subscriptions = {};\n            socket.send(ConnectionInit(onInit ? await onInit() : null).text);\n        };\n\n        socket.onclose = (e) => {\n            this.socketState.acknowledged = false;\n            this.socketState.subscriptions = {};\n        };\n\n        socket.onerror = (e) => {\n            console.error(e)\n        }\n\n        socket.onmessage = (e) => {\n            try {\n                const message = parseMessage(e.data)\n                switch (message.type) {\n                    case CONNECTION_ACK: {\n                        if (this.socketState.acknowledged) {\n                            console.warn(\"Duplicate CONNECTION_ACK message ignored\");\n                        } else {\n                            this.socketState.acknowledged = true\n                            if (onAcknowledged) onAcknowledged(message.payload)\n                        }\n                        return;\n                    }\n                    case PING: {\n                        if (onPing)\n                            onPing(message.payload).then(r => socket.send(Pong(r).text));\n                        else\n                            socket.send(Pong(null).text);\n                        return;\n                    }\n                    case PONG: {\n                        if (onPong) onPong(message.payload);\n                        return;\n                    }\n                }\n\n                if (!this.socketState.acknowledged) {\n                    // Web-socket connection not acknowledged\n                    return\n                }\n\n                if (message.id === undefined || message.id === null || !this.socketState.subscriptions[message.id]) {\n                    // No subscription identifer or subscription indentifier is not found\n                    return\n                }\n                const { query, variables, subscriber } = this.socketState.subscriptions[message.id]\n\n\n                switch (message.type) {\n                    case NEXT: {\n\n                        if (!message.payload.errors && message.payload.data) {\n                            subscriber.next && subscriber.next(message.payload.data);\n                        }\n                        if (message.payload.errors) {\n                            subscriber.error && subscriber.error(new ClientError({ ...message.payload, status: 200 }, { query, variables }));\n                        } else {\n                        }\n                        return;\n                    }\n\n                    case ERROR: {\n                        subscriber.error && subscriber.error(new ClientError({ errors: message.payload, status: 200 }, { query, variables }));\n                        return;\n                    }\n\n                    case COMPLETE: {\n                        subscriber.complete && subscriber.complete();\n                        delete this.socketState.subscriptions[message.id]\n                        return;\n                    }\n\n                }\n            }\n            catch (e) {\n                // Unexpected errors while handling graphql-ws message\n                console.error(e)\n                socket.close(1006);\n            }\n            socket.close(4400, \"Unknown graphql-ws message.\")\n        }\n    }\n\n    private makeSubscribe<T, V, E>(query: string, operationName: string | undefined, variables: V, subscriber: GraphQLSubscriber<T, E>): UnsubscribeCallback {\n\n        const subscriptionId = (this.socketState.lastRequestId++).toString();\n        this.socketState.subscriptions[subscriptionId] = { query, variables, subscriber }\n        this.socket.send(Subscribe(subscriptionId, { query, operationName, variables }).text);\n        return () => {\n            this.socket.send(Complete(subscriptionId).text)\n            delete this.socketState.subscriptions[subscriptionId]\n        }\n    }\n\n    rawRequest<T = any, V = Variables, E = any>(\n        query: string,\n        variables?: V,\n    ): Promise<{ data: T; extensions?: E }> {\n\n        return new Promise<{ data: T; extensions?: E; headers?: Dom.Headers; status?: number }>((resolve, reject) => {\n            let result: { data: T; extensions?: E };\n            this.rawSubscribe(query, {\n                next: (data: T, extensions: E) => (result = { data, extensions }),\n                error: reject,\n                complete: () => resolve(result),\n            }, variables);\n        });\n    }\n\n    request<T = any, V = Variables>(document: RequestDocument, variables?: V): Promise<T> {\n\n        return new Promise<T>((resolve, reject) => {\n            let result: T;\n            this.subscribe(document, {\n                next: (data: T) => (result = data),\n                error: reject,\n                complete: () => resolve(result),\n            }, variables);\n        });\n    }\n\n    subscribe<T = any, V = Variables, E = any>(document: RequestDocument, subscriber: GraphQLSubscriber<T, E>, variables?: V): UnsubscribeCallback {\n        const { query, operationName } = resolveRequestDocument(document)\n        return this.makeSubscribe(query, operationName, variables, subscriber)\n    }\n\n    rawSubscribe<T = any, V = Variables, E = any>(query: string, subscriber: GraphQLSubscriber<T, E>, variables?: V): UnsubscribeCallback {\n        return this.makeSubscribe(query, undefined, variables, subscriber)\n    }\n\n    ping(payload: Variables) {\n        this.socket.send(Ping(payload).text)\n    }\n\n    close() {\n        this.socket.close(1000);\n    }\n}\n\n// Helper functions\n\nfunction parseMessage<A = any>(data: string, f: (payload: any) => A = a => a): GraphQLWebSocketMessage<A> {\n    const m = GraphQLWebSocketMessage.parse<A>(data, f)\n    return m\n}\n\nfunction ConnectionInit<A>(payload?: A) {\n    return new GraphQLWebSocketMessage(CONNECTION_INIT, payload)\n}\n\nfunction Ping(payload: any) {\n    return new GraphQLWebSocketMessage(PING, payload, undefined)\n}\nfunction Pong(payload: any) {\n    return new GraphQLWebSocketMessage(PONG, payload, undefined)\n}\n\nfunction Subscribe(id: string, payload: SubscribePayload) {\n    return new GraphQLWebSocketMessage(SUBSCRIBE, payload, id)\n}\n\nfunction Complete(id: string) {\n    return new GraphQLWebSocketMessage(COMPLETE, undefined, id)\n}\n"]},"metadata":{},"sourceType":"script"}